package obss.cve.notificationservice;

import obss.cve.notificationservice.domain.Notification;
import obss.cve.notificationservice.model.Vulnerable;
import obss.cve.notificationservice.repository.NotificationRepository;
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Component;

@Component
public class Listener {

    private final NotificationRepository notificationRepository;

    public Listener(NotificationRepository notificationRepository) {
        this.notificationRepository = notificationRepository;
    }

    @KafkaListener(topics = "${vulnerable.detect.topic}", containerFactory = "kafkaListenerContainerFactory")
    public void listenDetection(Vulnerable vulnerable) {
        Notification notification = new Notification();
        notification.setInventoryId(vulnerable.getInventoryId());
        notification.setInventoryItemId(vulnerable.getInventoryItemId());
        notification.setCveId(vulnerable.getCveId());

        notificationRepository.save(notification);
    }
}
