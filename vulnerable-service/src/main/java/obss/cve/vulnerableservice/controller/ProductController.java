package obss.cve.vulnerableservice.controller;

import io.swagger.v3.oas.annotations.Operation;
import obss.cve.vulnerableservice.domain.CpeItem;
import obss.cve.vulnerableservice.model.ProductModelAssembler;
import obss.cve.vulnerableservice.service.ProductService;
import org.springframework.hateoas.CollectionModel;
import org.springframework.hateoas.EntityModel;
import org.springframework.web.bind.annotation.*;

import java.util.List;

@RestController
@RequestMapping("/api/v1/")
public class ProductController {

    private final ProductService productService;
    private final ProductModelAssembler productModelAssembler;

    public ProductController(ProductService productService, ProductModelAssembler productModelAssembler) {
        this.productService = productService;
        this.productModelAssembler = productModelAssembler;
    }

    @Operation(summary = "Gets a vulnerable")
    @GetMapping("/product/{vendor}/{product}")
    public EntityModel<CpeItem> one(@PathVariable String vendor, @PathVariable String product) {
        return productModelAssembler.toModel(productService.findOne(vendor, product));
    }

    @Operation(summary = "Gets list of all vendors")
    @GetMapping("/vendor")
    public List<String> vendor() {
        return productService.findAllVendors();
    }

    @Operation(summary = "Gets list of products of a vendor")
    @GetMapping("/vendor/{vendor}")
    public CollectionModel<EntityModel<CpeItem>> all(@PathVariable String vendor) {
        return productModelAssembler.toCollectionModel(productService.findAllByVendor(vendor));
    }
}
