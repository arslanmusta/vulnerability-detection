package obss.cve.notificationsendworker.proxy;

import com.atlassian.jira.rest.client.api.IssueRestClient;
import com.atlassian.jira.rest.client.api.JiraRestClient;
import com.atlassian.jira.rest.client.api.domain.input.IssueInput;
import com.atlassian.jira.rest.client.api.domain.input.IssueInputBuilder;
import obss.cve.notificationsendworker.SenderTask;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;

@Component
public class JiraProxy {

    private final JiraRestClient jiraRestClient;

    private static final Logger log = LoggerFactory.getLogger(JiraProxy.class);

    public JiraProxy(JiraRestClient jiraRestClient) {
        this.jiraRestClient = jiraRestClient;
    }

    public boolean sendIssue(String summary, String text) {
        try {
            IssueRestClient issueClient = jiraRestClient.getIssueClient();
            String projectKey = "VR";
            Long issueType = 10005L;
            String issueSummary = summary;
            IssueInput newIssue = new IssueInputBuilder(
                    projectKey, issueType, issueSummary)
                    .setDescription(text)
                    .build();
            String result = issueClient.createIssue(newIssue).claim().getKey();

            return true;
        }
        catch (Exception ex) {
            log.error(ex.getMessage(), ex);
            return false;
        }
    }
}
